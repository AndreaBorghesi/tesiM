%Andrea Borghesi
%Università degli studi di Bologna

%capitolo dedicato alla descrizione (breve) dell'ottimizzatore

%\documentclass[12pt,a4paper,openright,twoside]{report}
%\usepackage[italian]{babel}
%\usepackage{indentfirst}
%\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}
%\usepackage{fancyhdr}
%\usepackage{graphicx}
%\usepackage{titlesec,blindtext, color}
%\usepackage[font={small,it}]{caption}
%\usepackage{subfig}
%\usepackage{listings}
%\usepackage{color}
%\usepackage{url}
%\usepackage{textcomp}
%\usepackage{eurosym}
%\usepackage{amsmath}

%%impostazioni generali per visualizzare codice
%\definecolor{dkgreen}{rgb}{0,0.6,0}
%\definecolor{gray}{rgb}{0.5,0.5,0.5}
%\definecolor{mauve}{rgb}{0.58,0,0.82}
% 
%\lstset{ %
%  basicstyle=\footnotesize,           % the size of the fonts that are used for the code
%  backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
%  numbers=left,                   % where to put the line-numbers
%  numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
%  numbersep=5pt,  
%  showspaces=false,               % show spaces adding particular underscores
%  showstringspaces=false,         % underline spaces within strings
%  showtabs=false,                 % show tabs within strings adding particular underscores
%  rulecolor=\color{black}, 
%  tabsize=2,                      % sets default tabsize to 2 spaces
%  breaklines=true,                % sets automatic line breaking
%  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
%  title=\lstname,                   % show the filename of files included with \lstinputlisting;
%  frame=single,                   % adds a frame around the code
%                                  % also try caption instead of title
%  keywordstyle=\color{blue},          % keyword style
%  commentstyle=\color{dkgreen},       % comment style
%  stringstyle=\color{mauve},         % string literal style
%  escapeinside={\%*}{*)},            % if you want to add LaTeX within your code
%  morekeywords={*,...},              % if you want to add more keywords to the set
%  deletekeywords={...}              % if you want to delete keywords from the given language
%}

%%per avere un bordo intorno alle figure
%\usepackage{float}
%\floatstyle{boxed} 
%\restylefloat{figure}

%%per poter poi impedire che certe parole vadano a capo
%\usepackage{hyphenat}
%\usepackage{listings}

%%ridefinisco font per fancyhdr, per ottenere un'intestazione pulita
%\newcommand{\changefont}{ \fontsize{9}{11}\selectfont }
%\fancyhf{}
%\fancyhead[LE,RO]{\changefont \slshape \rightmark} 	%section
%\fancyhead[RE,LO]{\changefont \slshape \leftmark}	%chapter
%\fancyfoot[C]{\changefont \thepage}					%footer

%%titolo capitolo con "numero | titolo"
%\definecolor{gray75}{gray}{0.75}
%\newcommand{\hsp}{\hspace{20pt}}
%\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries}


%\oddsidemargin=30pt \evensidemargin=20pt

%%sillabazioni non eseguite correttamente
%\hyphenation{sil-la-ba-zio-ne pa-ren-te-si si-mu-la-to-re ge-ne-ra-re pia-no}

%%interlinea
%\linespread{1.15}  
%\pagestyle{fancy}

%%cartelle contenenti le immagini
%\graphicspath{{/media/sda4/tesi/immagini/grafici/}{/media/sda4/tesi/immagini/grafici/incCompare/}{/media/sda4/tesi/immagini/grafici/rawData/}{/media/sda4/tesi/immagini/grafici/regressionAnalysis/}{/media/sda4/tesi/immagini/schemi/}{/media/sda4/tesi/immagini/simulazione/}{/media/sda4/tesi/immagini/epolicy/}{/media/sda4/tesi/immagini/ottimizzazione/}}

%%in modo che dopo il titolo di un paragrafo il testo vada a capo
%\newcommand{\myparagraph}[1]{\paragraph{#1}\mbox{}\\}

%%per scrivere bene CLP(R) e CLP(FD)
%\newcommand{\clpr}{CLP({\ensuremath{\cal R}})}
%\newcommand{\clpfd}{CLP({\ensuremath{\cal FD}})}

%\begin{document}
\clearpage{\pagestyle{empty}\cleardoublepage}
\chapter{\nohyphens{Ottimizzazione}}
In aggiunta al modello di simulazione ad agenti, con la relativa prospettiva individuale, il progetto ePolicy ritiene necessario considerare anche una prospettiva globale (regionale nel caso della Regione), in grado di affrontare il problema della pianificazione e dalla valutazione degli impatti dei piani da un punto di vista più ampio, mantenendo al tempo stesso una stretta integrazione con il livello individuale.

La pianificazione delle attività regionale può essere vista come un complesso problema di ottimizzazione combinatoria; i decisori politici devono prendere decisioni e soddisfare un insieme di vincoli, tentando al tempo stesso di realizzare un certo numero di obiettivi, come ad esempio ridurre gli effetti negativi e incrementare i positivi su ambiente, società ed economia. La fase di valutazione - valutare quali siano gli impatti delle politiche scelte sull'ambiente ed in misura minora in ambito economico e sociale - è ora in genere effettuata in sequenza dopo la creazione di un piano, con lo svantaggio che se questo contenesse impatti negativi sull'ambiente potrebbero venire applicate solo delle contromisure correttive; per evitare ciò, nell'approccio di ePolicy la valutazione e la pianificazione sono condotte allo stesso tempo.\\*\\*
Per la valutazione ambientale sono stati proposti diversi metodi: un modello probabilistico \cite{logicDSSstrategicAss}, un modello fuzzy (la logica fuzzy prevede che si possa attribuire a una proposizione un grado di verità compreso tra 0 e 1) \cite{fuzzyLogicstrategicAss} e un modello lineare a vincoli (\emph{Constraint Logic Programming}, programmazione logica a vincoli, chiamata in seguito anche CLP) \cite{GavanelliEtAl}. Il motivo per sperimentare diversi tipi di modello è che le matrici usate dagli esperti ambientali si prestano a differenti interpretazioni, quindi era importante capire quale fosse la migliore scelta possibile. Il modello CLP è risultato essere il più veloce - a livello computazionale - in quanto per la programmazione lineare esistono tecniche di risoluzione molto efficienti. In secondo luogo, questo modello può essere facilmente esteso aggiungendo nuovi vincoli, per risolvere nuovi tipi di problemi; ad esempio se le attività da pianificare fossero variabili decisionali (invece che valori fissi) potremmo svolgere la pianificazione contemporaneamente alla valutazione ambientale. Dal momento che questo era uno degli scopi del progetto si è scelto di utilizzare l'approccio CLP.\\*\\*
In questo capitolo introdurremo molto brevemente la programmazione logica a vincoli, con una breve panoramica e citando gli strumenti software di cui ci siamo serviti, passeremo poi a presentare il modello sviluppato che incorpora al suo interno le attività di pianificazione e valutazione e infine mostreremo i risultati ottenuti applicando il modello al caso di studio scelto, ovvero il piano energetico 2011-2013 per la regione Emilia-Romagna.

\section[CLP]{\nohyphens{Programmazione logica a vincoli}}
Come abbiamo già ampiamente spiegato in precedenza il problema della creazione di un piano regionale può essere considerato come un problema caratterizzato da un insieme di vincoli e una funzione obiettivo. Nell'ambito dell'Intelligenza Artificiale i problemi per cui è richiesto soddisfare un insieme di vincoli sono definiti come \emph{Problemi di Soddisfacimento di Vincoli} (in inglese Constraint Satisfaction Problem, da cui l'acronimo \emph{CSP}). Un CSP è definito da una terna $<X,D,C>$, dove $X$ è un insieme di variabili $X=\{X_1,X_2...X_n\}$, $D$ è un dominio discreto per ogni variabile $D=\{D_1,D_2...D_n\}$ e $C$ è l'insieme di vincoli - un vincolo è una relazione tra variabili che definisce un sottoinsieme del prodotto cartesiano dei domini $D_1 \times D_2 \times ... \times D_n$; con queste premesse un la soluzione di un problema di soddisfacimento di vincoli è data da un assegnamento di valori alle variabili consistente con i vincoli \cite{cspFoundations}. Analogamente, un problema di ottimizzazione con vincoli (Constraint Optimization Problem, \emph{COP}) è definito da $<X,D,C,f>$, cioè un CSP più una \emph{funzione obiettivo} $f(X_1,X_2...X_n)$, la cui soluzione è un assegnamento di valori alle variabili compatibile con i vincoli del problema che ottimizza la funzione obiettivo. Le metodologie risolutive impiegate per risolvere problemi a vincoli attingono in buona parte alle tecniche di Ricerca Operativa e Intelligenza Artificiale, in particolare noi considereremo la \emph{Programmazione Logica a Vincoli}.\\*\\*
La programmazione logica a vincoli \cite{clpSurvey} (in inglese \emph{Constraint Logic Programming} da cui CLP) è una classe di linguaggi di programmazione che estendono la classica Programmazione Logica - il paradigma di programmazione basato sulla logica del primo ordine implementato da linguaggi come ad esempio Prolog \cite{Colmerauer,Kowalski,clocksin2003programming}, sviluppato nei primi anni settanta e ampiamente diffuso ancora oggi. Alle variabili possono essere assegnati sia termini (i tipi di dato e le strutture riconosciute in Prolog) sia valori interpretati, appartenenti a una determinata \emph{classe}, un parametro caratteristico dello specifico linguaggio CLP; per esempio è possibile avere \clpr \cite{clpR}, in grado di operare sui valori reali, oppure \clpfd, in cui le variabili appartengono a domini finiti. All'interno di una classe sono definite le funzioni interpretate (che possono essere nei domini numerici i soliti operatori $+$, $-$, $\times$, etc.) e i predicati (ad esempio, $<$, $\neq$, $\geq$, etc.), che sono chiamati \emph{vincoli}. La semantica dichiarativa consente l'interpretazione intuitiva per i vincoli e i termini, relativamente al dominio considerato: ad esempio, $1.3+2<5$ è \emph{vero} in \clpr; ciò è un'estensione molto significativa rispetto alla programmazione logica standard in quanto i linguaggi logici operano in domini non interpretati (``Universo di Herbrand'') e quindi le relazioni tra variabili possono essere solamente verificate a posteriori e non trattate come vincoli veri propri. La semantica operativa somiglia a quella di Prolog per atomi costruiti sui predicati usuali - quelli definiti da un insieme di clausole - ma conserva quelli da interpretare, i vincoli, in una struttura dati speciale, chiamata \emph{constraint store}; essa è in seguito interpretato e modificato da un meccanismo esterno, il \emph{constraint solver}, il risolutore dei vincoli. Il risolutore è in grado di controllare se una combinazione di vincoli è soddisfacibile o meno, e può modificare lo store, sperabilmente per semplificarne lo stato. Generalmente il solver non effettua una propagazione \emph{completa}: se una valutazione ha come risultati \emph{falso}, allora sicuramente la soluzione è impossibile, anche se in certi casi può capitare che il risolutore non rilevi l'impossibilità di un problema anche se non esistono soluzioni.\\*\\*  
\clpr è una classe di programmazione logica a vincoli in cui le variabili appartengo all'insieme dei numeri reali, i vincoli disponibili sono uguaglianze e disuguaglianze lineari e generalmente il risolutore è implementato tramite l'algoritmo del simplesso \cite{dantzig51}, molto veloce e completo per (dis)equazioni lineari (cioè è sempre in grado di restituire \emph{vero} o \emph{falso}). In alcuni sistemi, grazie alla disponibilità di risolutori efficienti per la programmazione lineare intera, certi vincoli non lineari sono accettati nel linguaggio, in particolare è possibile imporre che certe variabili assumano esclusivamente valori interi; in casi come questo la complessità del problema passa da P a NP-hard e il risolutore deve spesso ricorrere a tecniche di branch-and-bound. Ad ogni modo, l'utente può specificare anche una funzione obiettivo, un termine lineare che dovrebbe essere massimizzato o minimizzato garantendo al tempo stesso che tutti vincoli siano soddisfatti.


\section{Strumenti}
Al giorno d'oggi esistono numerose implementazioni di \clpr \cite{inclpR} e diverse versioni di Prolog dispongono di una propria libreria per \clpr. Per il progetto ePolicy si è scelto di adottare il software open source  ECL$^i$PS$^e$ \cite{clpEclipse,fromLPtoCLPeclipse}.

\subsection{ECL$^i$PS$^e$}
ECL$^i$PS$^e$ è un sistema software per lo sviluppo di applicazioni di programmazione a vincoli e indicata per lo studio di aspetti relativi alla risoluzione di problemi combinatori, come appunto la programmazione vincolata, modellazione di problemi, programmazione matematica, tecniche di ricerca di soluzioni, etc. Al suo interno sono contenuti librerie per risolutori a vincoli, un linguaggio di alto livello (derivato da Prolog), interfacce per risolutori esterni e altre funzionalità. In Figura~\ref{eclipseUI} mostriamo come si presenta l'interfaccia utente di ECL$^i$PS$^e$.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.28]{eclipseUI}
	\caption{ECL$^i$PS$^e$, Interfaccia Utente}
	\label{eclipseUI}
\end{figure}

Tra le diverse librerie disponibili, ne esiste una denominata \emph{Eplex} \cite{eplex} che interfaccia ECL$^i$PS$^e$ a un risolutore lineare intero, il quale può essere sia uno strumento commerciale, come CPLEX o Xpress-MP, che open source. A default Eplex nasconde molti dei dettagli del risolutore, ma nondimeno, quando richiesto, l'utente può regolare diversi parametri per migliorare le prestazioni ed esaminare lo stato interno del solver. Nell'ambito del progetto ePolicy ci siamo serviti di questa libreria, insieme alle altre funzionalità offerte da ECL$^i$PS$^e$, per modellare e risolvere i problemi relativi alla pianificazione energetica regionale.

Illustreremo ora due esempi di modellazione di problemi a vincoli sfruttando il linguaggio ECL$^i$PS$^e$ (nel primo caso considerando domini finiti e nel secondo valori reali, avvalendoci anche della libreria Eplex), anche per mostrare come possono essere strutturati i problemi di programmazione logica a vincoli; in questa trattazione supporremo noti i concetti elementari della programmazione logica (procedimenti risolutivi, definizioni di un termine, etc.), la cui discussione esula da questo lavoro.

\myparagraph{Esempio \clpfd}
Il cosiddetto \emph{Send More Money} puzzle è un esempio classico di programmazione a vincoli; le variabili $[S,E,N,D,M,O,R,Y]$ rappresentano cifre da 0 a 9 e lo scopo è assegnare alle variabili valori diversi in modo che l'operazione aritmetica di Figura~\ref{SendMoreMoney} risulti corretta - inoltre i numeri devono essere ben formati, da cui $S>0$ e $M>0$. 

\begin{figure}[h]
	\centering
	\includegraphics[width=0.215\textwidth]{sendMoreMoney}
	\caption{Send More Money puzzle}
	\label{SendMoreMoney}
\end{figure}

Con la programmazione convenzionale si avrebbe necessità di esprimere una strategia di ricerca in modo esplicito (senza contare possibili ottimizzazioni come cicli innestati), mentre con linguaggi logici come Prolog verrebbe sfruttata la ricerca fornita dal risolutore interno (il motore inferenziale), con il vantaggio di una programmazione estremamente facilitata ma col rischio di un'efficienza non elevata - a meno di programmi ottimizzati, i quali richiederebbero comunque maggiori tempo e abilità. 

Questo è in effetti il campo di applicazione ideale della programmazione logica a vincoli, in particolare nell'ambito  dei domini finiti \clpfd: le variabili possono assumere valori appartenenti ad un insieme finito di numeri interi, i vincoli sono facilmente esprimibili formalmente e occorre effettuare una certa quantità di ricerca nello spazio delle soluzioni. In questo problema sarebbe naturale usare le variabili del programma per rappresentare le diverse cifre e la soluzione finale dovrà essere un assegnamento di un valore unico per ogni variabile. 

Risolvere questo problema con Prolog comporta l'utilizzo della strategia di ricerca chiamata \emph{Generate and Test}, che prevede che prima la generazione di una soluzione e poi la verifica della consistenza dei vincoli e, nel caso che questa dia esito negativo, l'assegnamento di nuovi valori alle variabili seguita da nuova verifica e così via. In questo modo l'esplorazione dello spazio delle soluzioni è chiaramente inefficiente - per esempio la possibile implementazione in Prolog mostrata qui sotto, per quanto suscettibile a miglioramenti, deve gestire $\frac{10!}{2}$ possibili assegnamenti di valori alle variabili. 

\lstset{language=Prolog}
\begin{lstlisting}
% Send More Money puzzle in Prolog
smm :-
        X = [S,E,N,D,M,O,R,Y],           % variabili
        Digits = [0,1,2,3,4,5,6,7,8,9],	 % domini
        
        % predicato che assegna una soluzione
        assign_digits(X, Digits),
       	
       	%  verifica dei vincoli vincoli
        M > 0, 
        S > 0,
                  1000*S + 100*E + 10*N + D +
                  1000*M + 100*O + 10*R + E =:=
        10000*M + 1000*O + 100*N + 10*E + Y,
        write(X).

select(X, [X|R], R).
select(X, [Y|Xs], [Y|Ys]):- select(X, Xs, Ys).

assign_digits([], _List).
assign_digits([D|Ds], List):-
        select(D, List, NewList),
        assign_digits(Ds, NewList).
\end{lstlisting}

L'implementazione realizzata con ECL$^i$PS$^e$ presenta i vantaggi di semplificare ulteriormente la modellazione del problema e di appoggiarsi all'efficiente risolutore interno per l'esplorazione dello spazio delle soluzioni, in modo particolare il fatto che ogni volta che una variabile viene istanziata i vincoli vengono propagati per eliminare a priori strade inconsistenti, riducendo gli spazi delle soluzioni e prevenendo fallimenti sicuri. 

\begin{lstlisting}
% Send More Money puzzle in ECLiPSe
smm :-
     X = [S,E,N,D,M,O,R,Y],		% variabili
     X :: [0 .. 9],				% domini finiti
     
     % vincoli
     M #> 0,
     S #> 0,
               1000*S + 100*E + 10*N + D +
               1000*M + 100*O + 10*R + E #=
     10000*M + 1000*O + 100*N + 10*E + Y,
     alldistinct(X),
     
     % ricerca della soluzione
     labeling(X),
     write(X).

\end{lstlisting}

\myparagraph{Esempio \clpr - Eplex}

Presentiamo ora un esempio di un problema (Fig.~\ref{clpR_example}) che rientra nell'ambito dei \clpr e che fa uso della libreria Eplex, tratto dal manuale di ECL$^i$PS$^e$ \cite{eclipseTut}. Ci sono tre impianti, o fabbriche, (1-3) in grado di produrre un certo prodotto con capacità diverse e i cui prodotti devono essere trasportati a quattro clienti (A-D) con quantità richieste diverse; anche il costo unitario di trasporto ai clienti è variabile. L'obiettivo del problema è minimizzare i costi di trasporto soddisfacendo le esigenze dei clienti. 

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.7]{clpR_example}
	\caption{Esempio di un problema \clpr. Fonte \cite{eclipseTut}}
	\label{clpR_example}
\end{figure}

Per formulare il problema definiamo la quantità di prodotto trasportata dall'impianto $N$ al cliente $p$ come variabile $N_p$ - ad esempio $A_1$ rappresenta il costo di trasporto dalla fabbrica $A$ al cliente $1$. I vincoli da considerare sono di due tipi (sempre facendo riferimento alla Figura~\ref{clpR_example}):
\begin{itemize}
\item La quantità di prodotto consegnata da tutti gli impianti a un cliente deve deve essere uguale alla domanda del cliente, ad esempio per il cliente $A$ che può essere rifornito dagli impianti 1-3, abbiamo che $A_1+A_2+A_3=21$
\item La quantità di prodotto in uscita da una fabbrica non può essere superiore alla sua capacità produttiva, ad esempio per l'impianto $1$ che invia prodotti ai clienti A-D si ha che $A_1+B_1+C_1+D_1 \leq 50$
\end{itemize}   
Poiché lo scopo è minimizzare i costi di trasporto, la funzione obiettivo è di minimizzare i costi combinati del trasporto dei prodotti dai tre impianti a tutti e quattro i clienti.

La formulazione del problema è quindi la seguente.\\*
Funzione obiettivo: 
\begin{equation}  \label{exampleClpRObiett}
	\min(10A_1+7A_2+200A_3+8B_1+5B_2+10B_3+5C_2+5C_2+8C_3+9D_1+3D_2+7D_3)
\end{equation}
Vincoli:
\begin{equation}  \label{exampleCons1}
	A_1+A_2+A_3=21
\end{equation}
\begin{equation}  \label{exampleCons2}
	B_1+B_2+B_3=40
\end{equation}
\begin{equation}  \label{exampleCons3}
	C_1+C_2+C_3=34
\end{equation}
\begin{equation}  \label{exampleCons4}
	D_1+D_2+D_3=10
\end{equation}
\begin{equation}  \label{exampleCons5}
	A_1+B_1+C_1+D_1 \leq 50
\end{equation}
\begin{equation}  \label{exampleCons6}
	A_2+B_2+C_2+D_2 \leq 30
\end{equation}
\begin{equation}  \label{exampleCons7}
	A_3+B_3+C_3+D_3 \leq 40
\end{equation}

Mostriamo ora come questo problema venga modellato sfruttando la libreria Eplex. In primo luogo occorre caricare la libreria Eplex di cui si dispone (in questo caso abbiamo sfruttato un risolutore esterno open source) e ottenerne un'\emph{istanza}, la quale rappresenta un singolo problema sotto forma di modulo, a cui possono essere riferiti vincoli e funzione obiettivo consentendo quindi al solver esterno di risolvere il problema. Il codice che segue mostra come il problema di Figura~\ref{clpR_example} sia stato trasposto all'interno di ECL$^i$PS$^e$.

\begin{lstlisting}
:- lib(eplex).		% caricamento della libreria Eplex
:- eplex_instance(prob).		% definizione dell'istanza - chiamata 'prob'

main(Cost, Vars) :-
		% dichiarazione delle variabili e definizione del loro dominio		
		Vars = [A1,A2,A3,B1,B2,B3,C1,C2,C3,D1,D2,D3],
		prob: (Vars $:: 0.0..1.0Inf),  % valori maggiori o uguali a 0
		
		% definizione dei vincoli applicati all'istanza eplex
		prob: (A1 + A2 + A3 $= 21), 
		prob: (B1 + B2 + B3 $= 40),
		prob: (C1 + C2 + C3 $= 34),
		prob: (D1 + D2 + D3 $= 10),

		prob: (A1 + B1 + C1 + D1 $=< 50),
		prob: (A2 + B2 + C2 + D2 $=< 30),
		prob: (A3 + B3 + C3 + D3 $=< 40),

		% inizializza il solver esterno con la funzione obiettivo
		prob: eplex_solver_setup(min(10*A1 + 7*A2 + 200*A3 + 
			8*B1 + 5*B2 + 10*B3 +
		 	5*C1 + 5*C2 + 8*C3 +
		 	9*D1 + 3*D2 + 7*D3)),

		% ---------- Fine Modellazione ----------

		% risoluzione del problema
		prob: eplex_solve(Cost).
\end{lstlisting}

Per usare un'istanza Eplex occorre prima dichiararla con \emph{eplex\_instance/1}; una volta dichiarata, l'istanza viene riferita tramite il nome specificato. 

Come primo passo creiamo le variabili del problema e imponiamo che possano assumere solamente valori non negativi e rendiamo noti all'istanza il loro dominio (\emph{\$::/2}). Successivamente imponiamo i vincoli che modellano il problema sotto forma di uguaglianze e disuguaglianze aritmetiche; per via del solver esterno scelto, gli unici tipi di vincoli accettati sono quelli lineari - che ovviamente consentono una maggiore efficienza nella risoluzione.

Occorre poi inizializzare il risolutore esterno con l'istanza eplex creata, in modo che questa possa essere risolta. Questo è fatto dal \emph{eplex\_solver\_setup/1}, che prende come argomento la funzione obiettivo, la quale può essere di minimizzazione o massimizzazione. Infine è possibile risolvere il problema modellato attraverso \emph{eplex\_solve/1}.

Quando un'istanza viene risolta, il solver prende in considerazione tutti i vincoli ad essa relativi, i valori che le variabili del problema possono assumere e la funzione obiettivo specificata. In questo caso è possibile ottenere una soluzione ottimale pari a 710.0: 
\begin{lstlisting}
?-	main(Cost, Vars).

Cost = 710.0
Vars = [A1{0.0 .. 1e+20 @ 0.0}, A2{0.0 .. 1e+20 @ 21.0}, ....]
\end{lstlisting}

\section{Modellazione problema}

Passeremo ora ad occuparci dell'implementazione dell'ottimizzatore impiegato nell'ambito del progetto ePolicy per fornire supporto alle decisioni per lo sviluppo del piano energetico regionale.

In Figura~\ref{ioDSS} è presentata una visione generale e di alto livello dei fattori che entrano in gioco durante la creazione la fase di pianificazione, come i costi e la capacità produttiva degli impianti, gli impatti economici e ambientali delle azioni intraprese, i vincoli di budget e gli obiettivi di produzione energetica, etc. (benché non siano oggetto di discussione in questo capitolo sono inclusi per completezza nella figura anche gli impatti sociali e le modalità di incentivazione, gestite rispettivamente dal componente di Opinion Mining e dal simulatore).

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.45]{ioDSS}
	\caption{Panoramica di Input e Output del DSS di ePolicy}
	\label{ioDSS}
\end{figure}

\subsection[Approccio a vincoli]{\nohyphens{Perché un approccio basato sui vincoli}}
L'attività di pianificazione regionale è al momento svolta da esperti umani che costruiscono un singolo piano, considerando gli obbiettivi strategici regionali che seguono le direttive nazionali ed europee. Dopo che il piano è stato ideato l'ente per la protezione ambientale è chiamata a valutarne la sostenibilità dal punto di vista ambientale. In genere non c'è nessuna retroazione, la valutazione può solamente stabilire se il piano sia ecocompatibile o meno ma senza poterlo per modificare; in rari casi può proporre alcune misure correttive, le quali possono però solamente mitigare gli effetti negativi di decisioni di pianificazione sbagliate.

Oltre a ciò, sebbene le normative prevedano che una valutazione ambientale significativa debba confrontare due o più opzioni (piani differenti), questo è fatto raramente in Europa poiché la valutazione è tipicamente fatta a mano e richiede un lungo lavoro; anche nei pochi casi in cui due opzioni vengano considerate, solitamente una è il piano e l'altra è l'assenza di pianificazione.\\*\\*
La modellazione a vincoli supera le limitazioni dei processi manuali per diversi motivi. In primo luogo, essa fornisce uno strumento che automaticamente prende decisioni di pianificazione, tenendo in considerazione il budget allocato sulla base sia del piano operativo regionale che delle linee guida nazionali/europee.

Secondo, gli aspetti ambientali sono considerati durante la costruzione del piano, evitando di procedere per tentativi ed errori.

Come terza ragione, il ragionamento con i vincoli è uno strumento potente nelle mani di un decisore politico in quanto la generazione di scenari alternativi è estremamente semplificata ed il confronto e valutazione seguono naturalmente. Nel caso in cui i risultati non soddisfino coloro che stabiliscono le politiche o gli esperti ambientali gli aggiustamenti possono essere introdotti molto facilmente all'interno del modello; ad esempio, nel settore della pianificazione energetica regionale, cambiando i limiti della quantità di energia che ogni fonte può fornire, possiamo correggere il piano considerando l'andamento del mercato e anche la potenziale ricettività della regione.

\subsection{Modello CLP}
Il Piano Regionale è il risultato della principale attività di definizione delle politiche in cui le regioni europee siano coinvolte. Ogni regione dispone di un budget distribuito sulla base del Programma Operativo, il quale specifica le priorità di ogni regione per l'assegnamento dei fondi (nel campo dell'energia una esempio di priorità è l'incremento della produzione da fonti rinnovabili).

Partendo dalla struttura per il sistema di supporto alle decisioni descritta nel primo capitolo, ci accingiamo ora a illustrare il il modello per l'ottimizzazione globale ideato per prendere in considerazione la prospettiva regionale. 
\\* \\*
Nella fase di pianificazione occorre decidere quali attività debbano essere svolte, distinguendo a grandi linee sei tipologie: infrastrutture e impianti, edifici e trasformazioni sul territorio, estrazione delle risorse, modifiche del regime idrico, trasformazioni industriali, gestione dell'ambiente. Per ogni attività dovrebbe essere inoltre deciso un ordine di grandezza che descriva in quale quantità un'attività venga portata a termine.

Abbiamo quindi $N_a$ attività rappresentate con $a_i (i=1..N_a)$ e distinguiamo tra \emph{attività primarie} e \emph{attività secondarie}, nel caso del piano energetico esse sono rispettivamente quelle che producono direttamente energia e quelle che supportano le prime fornendo le necessarie infrastrutture. Possiamo quindi immaginare i seguenti tipi di input, collegati alla nozione di attività:
\begin{enumerate}
\item lista delle \emph{attività primarie} (impianti a biomassa, impianti fotovoltaici, impianti eolici, etc.) e \emph{quantità minime/massime} per ogni attività (es., aumento del 10\% la produzione di energia fotovoltaica);
\item \emph{funzione di costo}: consideriamo un vettore di costi $C=(c_1,...,c_{N_a})$ dove ogni elemento è associato ad una specifica attività e rappresenta il costo unitario della stessa - sostanzialmente si tratta di determinare il costo per MWatt di energia prodotta in base all'attività\footnote{Il costo di un impianto dipende principalmente dalla potenza installata: il costo di installazione di un impianto solare dipende dalla dimensione in metri quadri dei pannelli installati, da cui deriva di conseguenza una certa potenza massima. Notare come il costo considerato sia il costo totale per il sistema regionale, che non è lo stesso costo sostenuto dai contribuenti della regione Emilia-Romagna, poiché la regione può attuare le proprie politiche in diversi modi, convincendo i privati a investire nella produzione energetica. Ciò può essere fatto tramite una leva finanziaria oppure garantendo condizioni favorevoli (economiche i di altro tipo) agli investitori. Alcune fonti energetiche sono economicamente redditizie e quindi non richiedono sussidi da parte della regione. Ad esempio, le centrali a biomassa in Italia al giorno d'oggi sono economicamente vantaggiose per gli investitori, quindi i privati stanno proponendo diversi progetti per la costruzione di tali impianti; d'altra parte le biomasse producono anche inquinanti, non sono sempre sostenibili (vedere \cite{Cattafi} per una discussione ulteriore), quindi è probabile la nascita di comitati locali contrari alla costruzione di nuove centrali. Per queste ragioni, c'è un limite al numero di licenze che la regione concede agli investitori privati per la realizzazione di impianti a biomassa};
\item \emph{funzione di efficienza}: tramite un vettore per le produzioni energetiche $Out=(out_1,...,out_{N_a})$ determiniamo l'energia generata per ogni MWatt di potenza installata di ogni attività - questa funzione dipende dalla località geografica (ad esempio nell'Italia meridionale per via del clima soleggiato l'efficienza del fotovoltaico è maggiore rispetto alle aree settentrionali); 
\item \emph{la matrice delle attività primarie-secondarie} $D$, usata per stabilire quali attività secondarie e in quale misura sono necessarie per realizzare un determinato ammontare di attività primaria, ovvero una matrice di dipendenze tra le attività. 
\end{enumerate}
Ogni regione ha i propri obiettivi, alcuni intrinsecamente determinati dalla regione stessa altri conseguenze di decisioni politiche.
\begin{enumerate}
\item \emph{produzione richiesta/attesa}: in un piano energetico la produzione energetica attesa all'interno  dei confini regionali è basata sulle stime dei consumi energetici;
\item \emph{vincoli di budget}: ogni regione dispone di una certa quantità di fondi da destinare a incentivi con i quali indirizzare il mercato dell'energia nella direzione desiderata - dato un budget disponibile per il piano, questo è vincolato in termini di costo totale (questo vincolo può essere applicato sia al piano complessivo sia a parti di esso);
\item \emph{obiettivi politici}: sono forniti dai decisori politici, come ad esempio la priorità di conformarsi alla linea guida europea come l'iniziativa 20-20-20\footnote{L'iniziativa 20-20-20 mira a raggiungere tre obiettivi entro il 2020: ridurre del 20\% l'emissione di gas serra, produrre il 20\% dell'energia consumata attraverso fonti rinnovabili e migliorare del 20\% l'efficienza energetica.}, e possono essere traslati in vincoli che specificano la minima quantità di energia prodotta da fonti rinnovabili.
\end{enumerate} 

Infine occorre tenere in considerazione gli input relativi alla configurazione geofisica della regione e alla buona norma.
\begin{enumerate}
\item \emph{diversificazione delle fonti energetiche}: l'allocazione dei fondi non dovrebbe essere diretta verso un'unica fonte di energia ma coprire diverse risorse energetiche. Questo requisito è considerato come buona norma e supportato da numerose considerazioni, per esempio per assicurare ``robustezza'' nei confronti di fluttuazioni di prezzo e disponibilità delle varie risorse - queste indicazioni possono essere implementate sotto forma di vincoli che impongano che percentuali minime della produzione totale siano soddisfatte da ogni fonte energetica;
\item \emph{limiti sociali e geografici}: ogni regione ha le sue caratteristiche geofisiche (ad esempio, l'essere o meno ventose), che possono porre limiti alla quantità massima di energia generate da determinate risorse - le centrali idroelettriche possono essere costruite con un'attenta valutazione degli impatti ambientali che possono avere sul territorio, come, ovviamente, l'allagamento di vaste aree.
\end{enumerate} 

Un altro aspetto che i decisori politici devono considerare sono le ripercussioni su ambiente, società ed economia. Come già descritto nel primo capitolo uno degli strumenti per effettuare questa valutazione in Emilia-Romagna prevede l'impiego di matrici coassiali che definiscono le relazioni tra le attività primarie di un piano e gli impatti ambientali (o pressioni) positivi o negativi e in che modo tali attività influiscano sui recettori ambientali (anche essi introdotti in precedenza)\footnote{La matrice correntemente utilizzata per la valutazione ambientale contiene 93 attività, 29 impatti negativi, 19 positivi e 23 recettori e valuta 11 tipi di piano. Queste matrici prendono in esame anche in che modo le attività secondarie richieste impattino sui recettori}. 
\\*\\*
Lo scopo finale di un piano energetico può essere definito, più o meno, come il tentativo di guidare il mercato libero della produzione di energia verso la copertura del fabbisogno energetico regionale e il soddisfacimento di alcuni obiettivi politici. Per questo fine un piano consiste in un insieme di \emph{decisioni} riguardanti i seguenti aspetti:
\begin{enumerate}
\item quali tipi\footnote{Per la precisione i tipi di energia sono influenzati anche da alcuni obiettivi politici, presi come ingressi} (attività) di produzione energetica sia necessario impiegare e in che ordine di grandezza; 
\item quanti fondi debbano essere assegnati per spingere il mercato versa la produzione desiderata (attraverso l'implementazione di meccanismi incentivanti). Questa decisione può essere separata in due sotto-problemi:
	\begin{enumerate}
	\item la quantità di finanziamenti da allocare per promuovere ogni sistema di generazione di energia diverso, sotto forma di incentivi;
	\item i meccanismi per assegnare tali incentivi. 
	\end{enumerate}
\end{enumerate}

\subsection{Implementazione modello}
Illustreremo ora come sono stati modellate le problematiche introdotte precedentemente all'interno del paradigma della Programmazione Logica a Vincoli, in particolare sul dominio dei numeri reali.

\myparagraph{Matrici coassiali in \clpr}
Le matrici coassiali possono essere interpretate facilmente come modelli di programmazione lineare. Più in dettaglio, rappresentiamo le attività e i loro ordini di grandezza attraverso il vettore $A = (a_1,...,a_{N_a})$, dunque gli impatti ambientali causati dall'attività $i$ possono essere stimati col sistema di equazioni lineari:
\begin{equation}
\label{eq:impattiAtt}
	\forall j \in \{1,...,N_p\}  \quad p_j = m_j^i a_i
\end{equation}
Quando consideriamo un intero piano regionale, sommiamo i contributi di tutti le attività e otteniamo la stima dell'influenza esercitata su ogni impatto/pressione:
\begin{equation}
\label{eq:impattiAttTot}
	\forall j \in \{1,...,N_p\}  \quad  p_j = \sum_{i=1}^{N_a} m_j^i a_i
\end{equation}
Allo stesso modo, dato il vettore delle pressioni ambientali $P = (p_1,...,p_{N_p})$, è possibile calcolare l'influenza sul recettore ambientale $r_i$ per mezzo della matrice $N$, che collega pressioni e recettori:
\begin{equation}
\label{eq:pressRec}
	\forall j \in \{1,...,N_r\}  \quad  r_j = \sum_{i=1}^{N_p} n_j^i p_i
\end{equation}

L'obiettivo finale della valutazione di una politica ambientale è stimare l'impronta ambientale di un piano. Poiché il piano è definito da un insieme di valori che rappresentano l'ordine di grandezza delle attività previste, è possibile calcolare l'impronta ambientale $R = (r_1,...,r_{N_r})$ semplicemente applicando le equazioni (\ref{eq:impattiAttTot}) e (\ref{eq:pressRec}).
Un altro importante interrogativo che potrebbe interessare l'utente del sistema di supporto alle decisioni è sapere quali attività, tra quelle possibili, abbiano un maggiore impatto sul recettore $r_i$. Dal momento \clpr prevede di poter massimizzare o minimizzare una funzione obiettivo, il modello diventa:
\begin{equation}
\label{eq:impactOnGivenRec}
	\begin{aligned}
		max(r_i) \\
		s.t.  \quad (\ref{eq:impattiAttTot}) (\ref{eq:pressRec}) \\
		\sum_j a_j = 1 \\
		\forall j, a_j \mbox{ è intero} 
	\end{aligned}
\end{equation}

Infine, se ci sono leggi che impongono limiti per alcuni recettori (ad esempio sulla $CO_2$), è immediato imporre tali restrizioni sui recettori (es. $r_{CO_2} \leq limite_{CO_2}$), scoprendo quindi se un'attività può essere portata a termine o è necessario intraprendere misure correttive (ad esempio stimolare la crescita di nuove foreste per il $r_{CO_2}$).
\\* \\*
Nel casi in cui più attività alternative possano contribuire a soddisfare gli stessi bisogni, la regolamentazione prevede che le alternative debbano essere prese in esame e confrontate. Ad esempio, la necessità di energia elettrica aggiuntiva è soddisfatta dalla costruzione di una nuova centrale; in ogni caso, è possibile scegliere il tipo di impianto da realizzare in base alle condizioni ambientali. In un'area dall'elevato inquinamento atmosferico la costruzione di una centrale termoelettrica rischierebbe di aumentare il livello di inquinamento oltre la soglia imposta dalla legge, quindi sarebbe necessario progettare un tipo di impianto differente, ad esempio uno a energia solare. D'altro canto, un impianto solare potrebbe rivelarsi molto costoso e precludere dunque la realizzazione di altre attività indispensabili nell'aerea (costruire scuole, ospedali, etc.). In una simile circostanza il responsabile del piano potrebbe imporre un vincolo che afferma che sono necessari almeno $k$ MW di energia elettrica:
\begin{equation}
\label{eq:kEner}
	\sum_{i \in ImpiantiEnergetici} a_i \geq k
\end{equation}
(dove $ImpiantiEnergetici$ è l'insieme degli indici del vettore $A$ corrispondenti agli impianti che producono energia elettrica) e poi ottimizzare per uno dei recettori, es. $r_{CO_2}$, o qualche somma pesata dei ricettori d'interesse. O ancora, sarebbe possibile chiedere al DSS quale sia la massima produzione energetica possibile nella regione senza violare il limiti imposti dalla legge:  
\begin{equation}
\label{eq:maxOutLimLaw}
	\begin{aligned}
		max \sum_{{i \in ImpiantiEnergetici}}  a_i\\
		s.t. \quad (\ref{eq:impattiAttTot}) (\ref{eq:pressRec}) \\
		\forall i \in \{ 1,...,N_r \} \quad r_i \leq limite_i
	\end{aligned}
\end{equation}
In questo modo è possibile trovare il massimo numero di MW che possono essere prodotti e anche l'energia elettrica generata da ogni impianto. Il risolutore del problema CLP può inoltre trovare una soluzione che imponga l'esecuzione di attività di compensazione, come suggerito in precedenza.

\myparagraph{Analisi della sensibilità}
L'algoritmo del simplesso (applicabile grazie alla linearità dei vincoli del modello) fornisce in modo efficiente - nel nostro modello il tempo di computazione si è rivelato trascurabile - il valore ottimo della funzione obiettivo, l'assegnamento ottimo dei valori alle variabili decisionali, e altre informazioni utili per i decisori politici. In particolare consente di ricavare i cosiddetti \emph{costi ridotti} e la \emph{soluzione duale}. Questi indicatori danno informazioni preziose sulla sensibilità della soluzione trovata nei confronti dei parametri del modello e consentono di fare un tipo di analisi molto interessante per gli utenti del DSS.

La soluzione duale è un insieme di valori che corrispondono ai vincoli e può essere immaginata come la derivata della funzione obiettivo rispetto al lato destro dei vincoli (dall'inglese Right Hand Side, RHS). Ciò implica che attraverso la soluzione duale è immediato rendersi conto di quali siano i vincoli \emph{stretti}, ovvero quali modificherebbero il valore della funzione obiettivo se i coefficienti del lato destro cambiassero. Se ad esempio si cercasse di ottimizzare il numero $f_{MW}$ di MW di potenza elettrica con il vincolo $r_{CO_2} \leq limite_{CO_2}$ e il corrispondente valore duale $d_{CO_2}$ nella soluzione ottima fosse diverso da zero, questo significherebbe che:
\begin{equation}
\label{eq:sensAnal}
	d_{CO_2} = \frac{\partial f_{MW}}{\partial limite_{CO_2}}
\end{equation}
In altri termini, il valore della variabile $d_{CO_2}$ risponde alla domanda: \emph{``Quale sarebbe il decremento della produzione energetica nel caso in cui il limite di $CO_2$ si abbassasse di un punto?''}. Questo è un punto molto importante poiché le leggi tendono a cambiare, in genere diventando più severe. 

La stessa analisi potrebbe essere effettuata con il problema di ottimizzare alcuni recettori (o la loro somma pesata, dato un numero totale di impianti (o MW richiesti). In questo caso il valore duale associato ad un vincolo rappresenta quanto il recettore migliorerebbe se il vincolo fosse parzialmente rilassato (se il lato destro diventasse meno stringente). Ad esempio, supponiamo di ottimizzare le emissioni di ossidi di azoto ($NO_x$) e di avere un vincolo che imponga un limite superiore ($F$, es. in euro) al costo totale delle attività da portare a termine, dove il vettore $C$ specifica il costo di ogni attività: 
\begin{equation}
\label{eq:costoAtt}
	\sum_{i=1}^{N_a} c_i a_i \leq F
\end{equation}
Dopo aver ottenuto la soluzione ottima, il responsabile del piano potrebbe chiedersi: \emph{``Supponendo ora di disporre di più fondi, se aggiungessi un euro quanto diminuirebbe l'emissione di $NO_x$?''}. La risposta sarebbe data dal valore duale $d_e$ del vincolo \ref{eq:costoAtt}.

\myparagraph{Pianificazione con \clpr}

Dopo aver visto come effettuare la valutazione ambientale secondo il paradigma della \clpr, mostriamo ora come sia possibile integrare anche la fase di ideazione del piano regionale sfruttando le stesse metodologie di modellazione.
\\*\\*
Rappresentiamo nuovamente le attività tramite il vettore $A = (a_1,...,a_{N_a})$ e ad ognuna di esse associamo una variabile $G_i$ che ne descrive la grandezza; questa può essere rappresentata si in modo assoluto, come quantità di una data attività, che in modo relativo, come percentuale rispetto alla quantità esistente della stessa attività - in seguito faremo riferimento alla prima modalità.

Occorre distinguere tra attività primarie e secondarie: $A^P$ è l'insieme degli indici delle prime, mentre $A^S$ è l'insieme degli indici delle seconde. Le dipendenze tra attività primarie e secondarie sono espresse dal vincolo:
\begin{equation}
\label{eq:primSec}
	\forall j \in A^S  \quad  G_j = \sum_{i \in A^P} d_{ij} G_i
\end{equation}
Assegnato un valore $B_{Piano}$ al il budget disponibile a un determinato piano, si ha un equazione che limita il costo complessivo di un piano nel seguente modo:
\begin{equation}
\label{eq:costoTotPrimSec}
	\sum_{i=1}^{N_a} G_i c_i \leq B_{Piano}
\end{equation}  
Inoltre, data la produzione energetica attesa del piano $o_{Piano}$, abbiamo un vincolo che garantisce di raggiungere lo scopo prefissato:
\begin{equation}
\label{eq:expOut}
	\sum_{i=1}^{N_a} G_i o_i \geq o_{Piano}
\end{equation}  
Ad esempio in un piano energetico, il risultato desiderato potrebbe essere una maggiore disponibilità di energia in regione, così $o_{Piano}$ sarebbe l'incremento di energia elettrica (es. in MW) e $o_i$ sarebbe invece la produzione in MW di ogni attività $i$.

Per quanto riguarda gli obiettivi esistono diverse possibilità suggerite dagli esperti del settore. Da una prospettiva economica si potrebbe decidere di minimizzare il costo complessivo del piano (il quale sarebbe comunque soggetto ai vincoli sulla disponibilità finanziaria), ma chiaramente in questo caso potrebbero essere preferite le risorse energetiche più economiche, a prescindere dai loro potenziali effetti negativi sull'ambiente (nuovamente, questi potrebbero ad ogni modo essere vincolati). D'altro canto, si potrebbe fissare il budget e massimizzare invece la produzione energetica, prendendo in considerazione le risorse più efficienti. O ancora, si potrebbe decidere di realizzare un piano \emph{verde} e tenere in considerazione i recettori ambientali, ad esempio massimizzando la qualità dell'aria, delle acque superficiali, etc. Ovviamente in casi come questo le decisioni prodotte dalla soluzione ottima prodotta dall'ottimizzatore possono essere meno intuitive e proprio in circostanze simili il modello proposto si dimostra utile, infatti la relazione tra le decisioni riguardanti le attività primarie e secondarie e le conseguenze ambientali sono estremamente complesse da calcolare manualmente. \`E oggetto di ricerca la possibilità di creare funzioni obiettivo ancora più complicate combinando gli aspetti accennati sopra.
\\*\\*
Un aspetto importante da non sottovalutare durante l'ideazione di un piano regionale è la diversificazione delle fonti energetiche, cioè allocare le risorse economiche in fonti di energia diverse, sia rinnovabili che non rinnovabili, per prevenire fluttuazioni di prezzo e disponibilità. Per questo motivo è presente un vincolo sulla frazione minima $F_i$ dell'energia totale prodotta per ogni fonte $i$: 
\begin{equation}
\label{eq:fracEner}
	\forall i \in A^P \quad G_i o_i \geq F_i T^0
\end{equation}  
dove la produzione totale è ottenuta come: 
\begin{equation}
\label{eq:prodTot}
	T^0 = \sum_{j \in A^P} G_j o_j 
\end{equation}  
Oltre a ciò dobbiamo considerare le caratteristiche geofisiche della regione, come ad esempio il già citato caso delle centrali idroelettriche che possono essere costruite solamente prestando molta attenzione alle conseguenze sul territorio. Possiamo quindi imporre dei vincoli che limitino la massima energia $Max_i$ che può essere prodotta da una fonte energetica $i$:
\begin{equation}
\label{eq:maxEner}
	\forall i \in A^P \quad G_i o_i \leq Max_i
\end{equation}  
Infine, le priorità della regione dovrebbero essere conformi alle direttive e linee guida europee, come l'iniziativa 20-20-20. Per questa ragione, possono essere imposti vincoli sulla minima quantità di energia $Min_{rin}$ prodotta attraverso risorse rinnovabili, definendo $A^P_{rin}$ l'insieme di attività relative, ovvero:
\begin{equation}
\label{eq:minEnerRen}
	\sum_{i \in A^P_{rin}} G_i o_i \geq  Min_{rin}
\end{equation}  

\section{Il piano regionale 2011-2013}
Il modello a vincoli descritto in precedenza in questo capitolo è stato impiegato per la pianificazione del piano energetico 2011-2013 della regione Emilia-Romagna. Questo piano aveva come scopo quello di aprire la strada per il raggiungimento dell'obiettivo del 20-20-20, in particolare ottenere il 20\% dell'energia prodotta da fonti rinnovabili entro il 2020. Questa valore non si riferisce esclusivamente all'energia elettrica, ma prende in considerazione l'intero bilancio energetico della regione, includendo l'energia termica e i trasporti. 

Il settore dei trasporti può usare energia rinnovabile tramite l'uso di combustibili rinnovabili, come il biogas (metano prodotto dalla fermentazione di vegetali o scarti animali) o carburanti ottenuti da varie coltivazioni. L'energia termica può essere usata ad esempio per il riscaldamento delle abitazioni e in questo caso le fonti rinnovabili includono pannelli solari termici (i quali producono acqua calda per usi domestici), pompe geotermiche (impiegate per riscaldare o rinfrescare le case), impianti a biomassa (che producono acqua calda usata per riscaldare edifici vicini nei periodi invernali). 

Nel proseguo ci concentreremo solamente sull'energia elettrica e gli impianti considerati per la produzione di energia da fonti rinnovabili sono centrali idroelettriche, impianti fotovoltaici, impianti solari termodinamici, generatori eolici e, nuovamente, centrali a biomassa. Per ogni fonte energetica il piano dovrebbe fornire:
\begin{itemize}
\item la potenza installata in MW;
\item l'energia totale prodotta in un anno, in kTOE (TOE è una acronimo per Tonnes of Oil Equivalent, tonnellate di petrolio equivalenti);
\item il costo totale in M\euro.
\end{itemize} 
Il rapporto tra la potenza installata e l'energia totale prodotta è principalmente influenzato dalla disponibilità della risorsa: mentre una centrale a biomassa può produrre energia continuamente (almeno teoricamente), il sole è disponibile solo durante il giorno e il vento solo occasionalmente; per fonti energetiche non affidabili viene considerata una media annuale. 

Il costo dell'impianto dipende invece in maniera più significativa dalla potenza installata: un impianto solare ha un costo d'istallazione che dipende dalla superficie in metri quadri dei pannelli installati, i quali in cambio producono una certa potenza massima (potenza di picco).

I tecnici della regione hanno stimato (considerando i consumi di energia attuali, le previsioni di crescita, il risparmio energetico previsto) le richieste di energia complessiva per il 2020, di cui il 20\% dovrà essere generato a partire da fonti rinnovabili. Per questa quantità gli esperti hanno anche proposto la percentuale da ottenere con il piano 2011-2013, ovvero circa 177kTOE di energia elettrica e 296kTOE di energia termica. A partire da questi dati hanno poi redatto un piano per le energie elettrica e termica.

Abbiamo impiegato il modello a vincoli presentato precedentemente considerando inizialmente casi ``estremi'', nei quali venisse usata un'unica fonte energetica. Ad esempio se imponiamo di costruire solamente impianti a biomassa il modello fornisce i risultati presentati in Tabella~\ref{tab:energyPlanBiomassOnly}. Come detto in precedenza, oltre al piano viene fornita anche la valutazione ambientale.

\begin{table}[h]
\centering
	\begin{tabular}{ p {0.3\textwidth} | p {0.1\textwidth} p {0.1\textwidth}  p {0.1\textwidth} c }
	\hline \hline
	Impianti Elettrici & Potenza 2010 (MW) & Potenza 2013 (MW) & Energia 2013 (kTOE) & Investimenti (M\euro)\\
	\hline
	Idroelettrico & 300 & 300 & 67.06 & 0\\

	Fotovoltaico & 230 & 230 & 23.73 & 0\\
	
	Solare termodinamico & 0 & 0 & 0 & 0\\

	Eolico & 20 & 20 & 2.58 & 0\\

	Biomassa & 430 & 724.47 & 436.13 & 1030.64\\
	\hline
	Totale & 980 & 1274.47 & 529.5 & 1030.64\\
	\hline \hline
	\end{tabular}
	\caption{Esempio di piano energetico per l'elettricità realizzando unicamente centrali a biomassa}
	\label{tab:energyPlanBiomassOnly}	
\end{table}

Per meglio comprendere i contributi individuali delle varie forme di energia, in Figura~\ref{extremePlansPlot} sono stati tracciati graficamente i piani che usano una singola fonte energetica e quello sviluppato dagli esperti. Sull'asse delle $x$ è stato scelto il recettore \emph{Qualità dell'Aria}, in quanto tra i più sensibili per la regione Emilia-Romagna, mentre nell'asse delle $y$ è riportato il costo - i piani forniscono la stessa energia in kTOE ma richiedono l'istallazione di potenze diverse.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.45]{extremePlansPlot}
	\caption{Confronto tra il piano degli esperti e quelli estremi che sfruttano un'unica risorsa energetica}
	\label{extremePlansPlot}
\end{figure}

Notiamo subito che alcuni fonti energetiche migliorano la qualità dell'aria (valori positivi sull'asse delle $x$) mentre altre la peggiorano (valori negativi). Anche se , ovviamente, nessun impianto per la produzione di energia può migliorare la qualità dell'aria da solo (in quanto non può rimuovere le sostanze inquinanti dall'atmosfera), quello che accade è che gli impianti producono nuova energia elettrica senza introdurre ulteriori sostanze inquinanti, energia che, se non prodotta localmente, sarebbe dovuta essere importata da regioni vicine. In questo caso l'energia sarebbe stata prodotta sfruttando le stesse fonti energetiche della produzione nazionali, incluse quelle con emissioni inquinanti, quindi nel complesso il contributo è positivo per la qualità dell'aria. Sottolineiamo anche che diverse risorse energetiche hanno un diverso impatto sulla qualità dell'aria anche a causa della attività secondarie necessarie. 

Come ulteriore considerazione, occorre osservare che i piani ``estremi'' generalmente non sono fattibili, poiché nel nostro caso il vincolo sulla reale disponibilità di risorse energetiche è stato rilassato. A esempio le turbine eoliche forniscono una qualità dell'aria molto buona ad un costo contenuto, ma la quantità di produzione richiesta non è possibile in regione considerando la presenza media del vento e la disponibilità di aeree per l'istallazione.

Il piano proposto dagli esperti è più \emph{bilanciato}: tiene in considerazione la reale disponibilità della risorsa energetica nella regione e fornisce una combinazione di tutte le possibili fonti di energia - ciò è molto importante soprattutto per le risorse rinnovabili che spesso sono discontinue e quindi disporre di molteplici possibilità garantisce una fornitura elettrica costante e continuata.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.45]{paretoOpt}
	\caption{Frontiera ottima di Pareto della qualità dell'aria rispetto al costo}
	\label{paretoOpt}
\end{figure}

Oltre a valutare i piani proposti dagli esperti tramite il nostro modello è stato possibile crearne di alternativi. In particolare, un piano cercato è stato quello ottimale rispetto al costo e alla qualità dell'aria. Avendo una funzione con due obiettivi abbiamo tracciato il fronte ottimo di Pareto (riprendiamo qui la figura già brevemente descritta nel capitolo sul progetto ePolicy); ogni punto del fronte è tale che non è possibile migliorare uno dei due obiettivi senza peggiorare l'altro. Nel nostro caso la qualità dell'aria non può essere migliorata senza aumentare i costi e, viceversa, non è possibile ridurre il costo senza sacrificare il recettore considerato. La frontiera di Pareto è raffigurata in Figura~\ref{paretoOpt} insieme al piano realizzato dagli esperti. Benché questo piano sia vicino alla frontiera può comunque essere migliorato - in particolare si possono osservare sul fronte due punti che rappresentano due piani migliori, uno con costo uguale ma migliore qualità dell'aria, l'altro con qualità uguale ma costo minore. 

\begin{table}[h]
\centering
	\begin{tabular}{ p {0.3\textwidth} | p {0.1\textwidth} p {0.1\textwidth}  p {0.1\textwidth} c }
	\hline \hline
	Impianti Elettrici & Potenza 2010 (MW) & Potenza 2013 (MW) & Energia 2013 (kTOE) & Investimenti (M\euro)\\
	\hline
	Idroelettrico & 300 & 310 & 69.3 & 84\\

	Fotovoltaico & 230 & 850 & 87.7 & 2170\\
	
	Solare termodinamico & 0 & 10 & 1 & 45\\

	Eolico & 20 & 80 & 10.3 & 120\\

	Biomassa & 430 & 600 & 361.2 & 595\\
	\hline
	Totale & 980 & 1850 & 529.5 & 3014\\
	\hline \hline
	\end{tabular}
	\caption{Piano energetico ideato dagli esperti}
	\label{tab:expertPlan}	
\end{table}

\begin{table}[h]
\centering
	\begin{tabular}{ p {0.3\textwidth} | p {0.1\textwidth} p {0.1\textwidth}  p {0.1\textwidth} c }
	\hline \hline
	Impianti Elettrici & Potenza 2010 (MW) & Potenza 2013 (MW) & Energia 2013 (kTOE) & Investimenti (M\euro)\\
	\hline
	Idroelettrico & 300 & 303 & 67.74 & 25.2\\

	Fotovoltaico & 230 & 782.14 & 80.7 & 1932.51\\
	
	Solare termodinamico & 0 & 5 & 0.5 & 22.5\\

	Eolico & 20 & 140 & 18.03 & 240\\

	Biomassa & 430 & 602.23 & 362.54 & 602.8\\
	\hline
	Totale & 980 & 1832.37 & 529.5 & 2823\\
	\hline \hline
	\end{tabular}
	\caption{Piano energetico che domina quello degli esperti, con stessa qualità dell'aria ma costo inferiore}
	\label{tab:betterCostPlan}	
\end{table}

La Tabella~\ref{tab:expertPlan} mostra il piano degli esperti mentre la Tabella~\ref{tab:betterCostPlan} presenta un piano che domina quello degli esperti, con la stessa qualità dell'aria ad un costo inferiore. L'energia generata con le turbine eoliche è quasi raddoppiata (poiché forniscono un buon rapporto qualità-aria/costo, vedi Fig.~\ref{extremePlansPlot}), c'è un leggero incremento nella produzione da biomassa e le fonti restanti sono parzialmente ridotte di conseguenza.

Per quanto riguarda la valutazione ambientale, in Figura~\ref{receptors_pareto} sono mostrati i valori dei recettori in alcuni punti significativi della frontiera di Pareto. Ogni barra rappresenta un singolo recettore ambientale per un piano specifico sul fronte di Pareto di Fig.~\ref{paretoOpt}; la barra azzurra è associata al piano che garantisce la migliore qualità dell'aria mentre le barre nei restanti colori sono associate a piani di dal costo inferiore. I recettori mostrano tendenze differenti: alcuni migliorano muovendosi lungo la frontiera verso una maggiore qualità dell'aria (come la qualità del clima, benessere della popolazione, valore dei beni materiali), mentre migliorano procedendo verso soluzioni a costo inferiore (qualità del paesaggio, benessere della fauna selvatica, qualità dei terreni). Questo fatto è dovuto a diverse ragioni, che dipendono sia dal tipo di impianto installato che dalle attività secondarie richieste.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.65]{receptors_pareto}
	\caption{Valore dei recettori sulla frontiera di Pareto}
	\label{receptors_pareto}
\end{figure}

Ad esempio le turbine eoliche hanno un buon effetto sulla qualità dell'aria ma sono al tempo stesso considerato poco piacevoli dal punto di vista estetico, quindi non possono essere installati in determinate zone sensibili, come la cima delle colline, senza dover affrontare proteste dai parte dei residenti (recettore qualità del paesaggio); sfortunatamente, colline sono anche le aree più ventose in Emilia-Romagna. 

O ancora, poiché gli uccelli migratori seguono i percorsi dei venti per ridurre la fatica nei loro viaggi su lunghe distanze ma d'altro canto gli impianti eolici devono essere collocati in zone ventose per essere efficaci, si ha come conseguenza che durante la stagione delle migrazioni gli stormi rischierebbero di entrare in collisione con le grandi pale dei generatori; questo effetto non può essere ignorato, in particolare per specie a rischio (benessere della fauna selvatica).

%\nocite{*}
%\bibliographystyle{plain}
%\bibliography{bibliography}

%\end{document}
