%Andrea Borghesi
%Università degli studi di Bologna

%capitolo dedicato alla simulazione 

\documentclass[12pt,a4paper,openright,twoside]{report}
\usepackage[italian]{babel}
\usepackage{indentfirst}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{titlesec,blindtext, color}
\usepackage[font={small,it}]{caption}
\usepackage{subfig}
\usepackage{listings}
\usepackage{color}

%impostazioni generali per visualizzare codice
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
 
\lstset{ %
  basicstyle=\footnotesize,           % the size of the fonts that are used for the code
  backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  tabsize=2,                      % sets default tabsize to 2 spaces
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
  title=\lstname,                   % show the filename of files included with \lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},          % keyword style
  commentstyle=\color{dkgreen},       % comment style
  stringstyle=\color{mauve},         % string literal style
  escapeinside={\%*}{*)},            % if you want to add LaTeX within your code
  morekeywords={*,...},              % if you want to add more keywords to the set
  deletekeywords={...}              % if you want to delete keywords from the given language
}

%per avere un bordo intorno alle figure
\usepackage{float}
\floatstyle{boxed} 
\restylefloat{figure}

%per poter poi impedire che certe parole vadano a capo
\usepackage{hyphenat}
\usepackage{listings}

%ridefinisco font per fancyhdr, per ottenere un'intestazione pulita
\newcommand{\changefont}{ \fontsize{9}{11}\selectfont }
\fancyhf{}
\fancyhead[LE,RO]{\changefont \slshape \rightmark} 	%section
\fancyhead[RE,LO]{\changefont \slshape \leftmark}	%chapter
\fancyfoot[C]{\changefont \thepage}					%footer

%titolo capitolo con "numero | titolo"
\definecolor{gray75}{gray}{0.75}
\newcommand{\hsp}{\hspace{20pt}}
\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries}


\oddsidemargin=30pt \evensidemargin=20pt

%sillabazioni non eseguite correttamente
\hyphenation{sil-la-ba-zio-ne pa-ren-te-si si-mu-la-to-re ge-ne-ra-re pia-no}

%interlinea
\linespread{1.15}  
\pagestyle{fancy}

%cartelle contenenti le immagini
\graphicspath{{/media/sda4/tesi/immagini/grafici/}{/media/sda4/tesi/immagini/schemi/}{/media/sda4/tesi/immagini/simulazione/}}


\begin{document}
\chapter{SIMULAZIONE}

In questo capitolo verrà illustrato in che modo abbiamo studiato le relazioni che legano i diversi aspetti del piano energetico regionale, concentrandoci particolarmente su come la creazione di meccanismi di incentivazione da parte della regione Emilia-Romagna possa influenzare la produzione di energia elettrica proveniente da impianti fotovoltaici.
Per capire queste relazioni abbiamo scelto un approccio basato sulle simulazioni, cioè di realizzare un modello dell'aspetto della realtà da noi preso in esame e attraverso esso esaminare le dinamiche del sistema di nostro interesse.
\\*
Ora saranno presentati gli strumenti di cui ci siamo serviti implementare il modello sopra citato e in seguito il simulatore vero e proprio, spiegandone caratteristiche, funzionalità e limitazioni.

\section{STRUMENTI}

Gli strumenti principali che abbiamo utilizzato per realizzare il simulatore sono due:\begin{itemize}
	\item \emph{Netlogo}, un software che offre un ambiente di sviluppo ideale per la realizzazione di modelli di simulazioni ad agenti, di networks e di sistemi dinamici (sviluppato nel presso il Center for Connected Learning and Computer-Based Modeling della Northwestern University);
	\item \emph{R}, ambiente di sviluppo open source specifico per l'analisi statistica dei dati, basato sull'omonimo linguaggio di programmazione.
\end{itemize}

\subsection{NETLOGO}

Netlogo è un linguaggio di programmazione e ambiente di sviluppo open source che permette la modellazione di sistemi complessi formati da molteplici agenti che interagiscono tra loro, studiandone l'evoluzione  e visualizzandola in tempo reale.
\\* L'ambiente di sviluppo è scritto in Java (con il vantaggio quindi di ottenere una grande portabilità del software stesso) e il linguaggio eredita ed estende le caratteristiche del linguaggio di programmazione multiparadigma Logo, realizzato negli anni '60 presso il Massachusetts Institute of Technology e caratterizzato dalla sua derivazione dal Lisp e le numerose applicazioni in ambito educativo. Il codice che definisce il comportamento degli agenti è interpretato senza necessità di essere compilato e questa caratteristica permette un'interazione a run time con il modello stesso (modificare parametri di controllo attraverso pulsanti e sliders, visualizzare dinamicamente variabili o grafici relativi alla simulazione in corso, etc..).

\paragraph{Ambiente di sviluppo}

All'interno di Netlogo un elemento fondamentale è il "mondo virtuale", ovvero l'ambiente della simulazione all'interno del quale i diversi agenti agiscono. Gli agenti, le entità che possono eseguire istruzioni, possono essere di quattro tipi (Fig.~\ref{netlogoWorld}): \begin{itemize}
\item \emph{turtles} (tartarughe), gli agenti che possono muoversi all'interno del mondo;
\item \emph{patches}, le aeree quadrate che costituisco il mondo bidimensionale di Netlogo e sopra le quali si possono spostare le turtles;
\item \emph{links}, i collegamenti tra due diverse turtles, non hanno una posizione né risiedono su patches e possono orientati o non orientati;
\item \emph{observer}, il quale rappresenta concettualmente la vista complessiva del modello visto da fuori e contiene tutte le informazioni macro del modello e, quindi, tutte le variabili globali che lo caratterizzano.
\end{itemize}

\begin{figure}[htb]
	\begin{center}
	\includegraphics[scale=0.3]{netlogoWorld}
	\end{center}
	\caption{Il mondo virtuale di Netlogo}
  	\label{netlogoWorld}
\end{figure}

Le tartarughe popolano il modello ed operano in parallelo, interagendo tra loro e con le patches su cui si muovono; possono essere specificate diverse tipologie di turtles che, nel linguaggio Logo, prendono il nome di breed, ovvero razza, caratteristica che in parte richiama il concetto di classe nel paradigma della programmazione ad oggetti, in quanto ogni razza possiede una lista di attributi e variabili proprietarie comuni solo agli agenti che vi appartengono.\\*\\*
L'ambiente di sviluppo è costituito da un'interfaccia grafica che consente di interagire intuitivamente con i parametri che regolano il modello o eseguire determinate azioni, attraverso l'uso di determinati pulsanti, sliders o altri elementi inseriti durante lo sviluppo del modello; questa interfaccia ha anche l'importante funzione di mostrare in tempo reale i movimenti degli agenti all'interno del mondo virtuale e presentare durante e dopo la simulazione le informazioni relative alla stessa, sotto forma di grafici, tabelle, etc...\\*
Accanto all'interfaccia grafica è ovviamente presente la sezione che riguarda il codice, il quale definisce i comportamenti delle entità  che agiscono dentro il mondo virtuale. Il codice della simulazione risiede tutto all'interno di un unico listato, suddiviso in diverse procedure che sono destinate all'esecuzione da parte degli agenti o, in maniera del tutto generale, di tutte le istanze che costituiscono il modello. Le procedure, in NetLogo, vengono suddivise in due diverse tipologie, ovvero \emph{commands}, azioni che devono essere portate a termine da un agente producendo un qualche risultato, e \emph{reporters}, istruzioni per calcolare un determinato valore che verrà riportato dall'agente a chiunque lo richieda. \\*
In Figura ~\ref{netlogoUI_code} sono mostrati un esempio di una parte di iterfaccia grafica con relativi selettori e rappresentazione del mondo virtuale e il codice relativo al pulsante \emph{setup} di tale interfaccia.

\begin{figure}[hbt]
	\centering
	\subfloat[Interfaccia Grafica]{\includegraphics[scale=0.4]{netlogoUI}\label{netlogoUI}}
	\quad 
	\subfloat[Codice]{\includegraphics[scale=0.45]{netlogoCode}\label{netlogoCode}}
	\caption{Esempio dell'ambiente di sviluppo di NetLogo}
	\label{netlogoUI_code}
\end{figure}

Altro elemento fondamentale dell'ambiente di sviluppo è rappresentato dalla gestione delle variabili aggregate e le relative statistiche. Poiché lo scopo di un modello di simulazione ad agenti è spesso rappresentato dalla necessità di comprendere a livello globale il comportamento di un sistema descritto nelle sue singole componenti ne deriva la necessità di calcolare e rappresentare l'andamento nel tempo di variabili aggregate per valutare qualitativamente il modello. In NetLogo ad ognuna delle variabili del modello è possibile associare un oggetto monitor, che ne mostra dinamicamente le variazioni, oppure un grafico, che ne raffigura l'andamento nel tempo. Gli  oggetti che permettono la gestione dei grafici sono \emph{plot} e \emph{histogram}, entrambi da definire sia a livello d'interfaccia grafica come avviene anche per le procedure, sia nel codice della simulazione.\\* 


\subsection{R}

Come già accennato, R è un linguaggio di programmazione open source e un ambiente software usato per la manipolazione di dati, calcolo e analisi statistica e presentazione grafica dei risultati. Il design R è stato ampiamente influenzato da due linguaggi preesistenti, S sviluppato da J.Chambers e colleghi presso i Bell Laboratories negli anni '70 e Scheme creato presso il MIT AI Lab sempre negli anni settanta da G.L.Steele e G.J.Sussman. \\*
Il nucleo di R consiste di un linguaggio interpretato a cui sono state aggiunte numerose funzionalità per un grande numero di procedure statistiche;  tra queste è possibile ricordarne alcune: modelli di regressione lineare, lineare generalizzata e non lineare, analisi di serie temporali, classici test parametrici e non, clustering, classificazione e altre. R è facilmente estendibile grazie alla presenza di numerosi pacchetti software creati dagli utenti e dedicati a specifiche aree di studio e possiede inoltre un grande insieme di funzioni indicate per una presentazione flessibile ed efficiente dei dati e la produzione di grafici di qualità.\\*
Per interagire con l'interprete del linguaggio R è possibile fornire le istruzioni direttamente da riga di comando oppure appoggiarsi a interfacce grafiche, ma per le nostre necessità è stato sufficiente utilizzare la riga di comando\\* \\* 
Per via della sua derivazione da S, R presenta alcune caratteristiche che lo fanno rientrare all'interno del paradigma dei linguaggi Object Oriented, almeno parzialmente, e al tempo stesso possiede alcuni aspetti che lo avvicinano alla natura dei linguaggi funzionali(come Scheme), come ad esempio la possibilità di trattare le funzioni stesse come oggetti.\\* Le principali strutture dati sono le seguenti: \begin{itemize}
\item \emph{vettori}, singole entità costituite da una collezione di valori di un certo tipo come ad esempio numerici,logici o caratteri;
\item \emph{matrici (arrays)}, generalizzazioni multi-dimensionali di vettori;
\item \emph{liste}, forme di vettori più generali nelle quali gli elementi non devono necessariamente essere dello stesso tipo;
\item \emph{fattori}, oggetti simili ai vettori usati per specificare una classificazione (raggruppamento) delle componenti di altri vettori con la stessa lunghezza;
\item \emph{data frames}, strutture simili alle matrici in cui le colonne possono essere di tipi diversi;
\item \emph{funzioni}, le quali sono esse stesse oggetti e forniscono così un modo semplice e flessibile di estendere R.
\end{itemize}
Come in ogni linguaggio di programmazione è poi ovviamente possibile manipolare queste strutture dati attraverso operatori, strutture di controllo, funzioni, etc...\\* \\*
Illustreremo ora un brevissimo esempio per far capire un possibile utilizzo di R per effettuare una semplice analisi statistica. Supponiamo di voler studiare la relazione che lega due variabili, \emph{a} e \emph{b}, i cui valori si trovano in un file di tipo \emph{Comma Separated Values}. Il primo passo è importare tali valori dal file e inserirli in una struttura dati, in questo caso una matrice con due colonne (una per ogni variabile) e ordinarli in base ai valori della prima variabile.

\lstset{language=R}
\begin{lstlisting}
> matrice.dati <- read.csv("file.csv")
> matrice.ordinata <- matrice_dati[order(matrice.dati$a),]
\end{lstlisting}

A questo punto sarebbe possibile svolgere diverse operazioni sui dati (ad esempio calcolare per ogni valore di ogni variabile i valori medi,...) ma ci limiteremo a effettuare una semplice regressione lineare.
\begin{lstlisting}
> modello.lineare <- lm(matrice$b ~ matrice$a)
\end{lstlisting}

\begin{figure}[hbt]
	\centering
	\subfloat[Grafico]{\includegraphics[scale=0.4]{example_r_graph}\label{example_r_graph}} 
	\quad
	\subfloat[Analisi statistica]{\includegraphics[scale=0.6]{example_r_result}\label{example_r_result}}
	\caption{Esempio di utilizzo di R}
	\label{example_r}
\end{figure}

R ci consente ora di effettuare analisi statistiche sul modello di regressione applicato per stabilirne validità e significatività in rapporto ai dati in nostro possesso e successivamente di presentare graficamente i risultati ottenuti.
\begin{lstlisting}
> #analisi statistica minima
> summary(modello.lineare)       
> #disegna i punti corrispondenti ai valori nella matrice
> plot(matrice$b ~ matrice$a,type="p",lwd=3,ylab="b",xlab="a")    
> #disegna la curva di regressione
> lines(matrice$a,predict(modello.lineare), lty="solid", col="darkred", lwd=2)    
\end{lstlisting}


In Figura ~\ref{example_r} sono stati riportati il grafico prodotto da questo esempio e i risultati ottenuti dalla semplicissima analisi statistica, tra i quali notiamo il coefficiente di determinazione (R-squared) e l'errore residuo ( 
Residual standard error).



\section{MODELLO AD AGENTI}


In generale esistono numerose tecniche di simulazione che si differenziano per i diversi metodi di formalizzazione dei modelli, i linguaggi simbolici usati e i gli ambiti di applicazione più indicati (tecniche matematiche, statistiche, sperimentali,..). In questo lavoro abbiamo scelto di sviluppare un modello basato sul paradigma della simulazione ad agenti, il quale trae origine dall'unione della teoria della complessità con l'intelligenza artificiale distribuita.\\*\\*
Possiamo iniziare con un definizione, spiegando quindi ciò che si intende col concetto di \emph{agente}, ovvero qualsiasi cosa possa essere vista come un sistema che percepisce il suo ambiente attraverso sensori e agisce su di esso mediante attuatori, in particolare un agente software è un'istanza di una classe del paradigma della programmazione ad oggetti, ovvero un oggetto indipendente  che incapsula proprietà e funzioni autonome ed interagisce, secondo protocolli di comunicazione, con altri oggetti/agenti altrettanto autonomi.\\*


\section{SIMULATORE BASE}


Dopo aver introdotto nei paragrafi precedenti gli strumenti software che abbiamo utilizzato e il tipo di metodologia scelta, è giunto ora il momento di illustrare dettagliatamente come il modello da simulare sia stato implementato. Ci concentreremo prima sulla versione iniziale della simulazione ad agenti che ha lo scopo di modellare, individuare ed analizzare le principali caratteristiche che influenzano la scelta di un investimento nel settore dell'energia da fonti rinnovabili sul territorio della regione Emilia-Romagna, ed in particolare nel fotovoltaico.\\*
Dalla prospettiva degli agenti (privati, aziende,...) prima di realizzare un investimento in questo settore è necessario effettuare alcuni studi relativi al luogo di installazione, all'irraggiamento solare, alla potenza dell'impianto ed al suo rendimento e contestualmente è di fondamentale importanza effettuare un'analisi approfondita che consenta di verificare con esattezza la convenienza ed il ritorno economico dell'investimento.\\*
La simulazione è stata pensata con lo scopo di analizzare le esigenze connesse allo sviluppo di un nuovo progetto  fotovoltaico in fase di pianificazione e verificare la fattibilità dell'idea, fornendo quindi un utile strumento di valutazione per i singoli investitori, ma allo stesso tempo consente di ricavare informazioni di natura più globale, come la quantità totale di energia prodotta con tecnologie fotovoltaiche o le spese sostenute dalla regione, grazie alle quali è possibile integrare i risultati delle simulazioni all'interno del problema di ottimizzazione che ha come obiettivo la creazione di un piano energetico regionale.


\subsection{METODO DI INCENTIVAZIONE}


\section{SIMULATORE ESTESO}

\subsection{MODALITÀ INCENTIVANTI}

\subsection{INTERAZIONE SOCIALE}


\section{LIMITI SIMULATORE}



\end{document}
